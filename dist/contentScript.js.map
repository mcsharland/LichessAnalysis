{"version":3,"file":"contentScript.js","mappings":";;;;;;AAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB,8CAA8C,qDAAqD;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,yCAAyC,gCAAgC;AACzE;AACA;AACA;AACA;AACA;AACA,uBAAuB,eAAe;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC","sources":["webpack://chess-analysis/./src/contentScript.ts"],"sourcesContent":["\"use strict\";\nconst parser = (pgn) => {\n    // matches valid chess moves\n    const regex = /(?:[NBRKQ]?(?:[a-h]|[1-8])?x?[a-h][1-8](?:=[QNBR])?|O-O|O-O-O)[+#]?/;\n    const strings = pgn.split(/\\s+/);\n    const newstrings = strings.filter((str) => regex.test(str));\n    /*\n      Check if the last element contains '#' and remove it\n      The trailing '#' will prevent the board from being flipped\n    */\n    if (newstrings.length > 0 &&\n        newstrings[newstrings.length - 1].includes(\"#\")) {\n        newstrings[newstrings.length - 1] = newstrings[newstrings.length - 1].replace(\"#\", \"\");\n    }\n    return newstrings.join(\"_\");\n};\nconst disableButton = (button) => {\n    if (button) {\n        button.disabled = true;\n    }\n};\n// maybe not needed but these ensure theres no unintended behavior\nlet isLichessInProgress = false;\nlet ready = false;\nconst hijackButton = (button) => {\n    var _a;\n    if (button) {\n        const clonedButton = button.cloneNode(true);\n        (_a = button.parentNode) === null || _a === void 0 ? void 0 : _a.replaceChild(clonedButton, button);\n        clonedButton.addEventListener(\"click\", (event) => {\n            event.preventDefault();\n            if (!isLichessInProgress) {\n                isLichessInProgress = true;\n                lichess();\n            }\n        });\n        clonedButton.disabled = false;\n        if (button.dataset.cy === \"sidebar-game-review-button\") {\n            clonedButton.innerHTML = '<span aria-hidden=\"true\" class=\"ui_v5-button-icon icon-font-chess best\"></span> <span>Lichess</span>';\n        }\n        else if (clonedButton.classList.contains(\"game-over-review-button-background\")) {\n            const parentDiv = clonedButton.parentElement;\n            const labelSpan = parentDiv === null || parentDiv === void 0 ? void 0 : parentDiv.querySelector(\".game-over-review-button-label\");\n            if (labelSpan) {\n                labelSpan.textContent = \"Lichess Analysis\";\n                const observer = new MutationObserver((mutations) => {\n                    mutations.forEach((mutation) => {\n                        if (mutation.type === \"childList\" || mutation.type === \"characterData\") {\n                            const currentText = labelSpan.textContent;\n                            if (currentText !== \"Lichess Analysis\") {\n                                labelSpan.textContent = \"Lichess Analysis\";\n                            }\n                        }\n                    });\n                });\n                observer.observe(labelSpan, { childList: true, characterData: true, subtree: true });\n            }\n        }\n    }\n    else {\n        throw new Error(\"button not found\");\n    }\n};\nconst gameEndObserver = new MutationObserver((mutations, observer) => {\n    const gameReviewButton = document.querySelector('[data-cy=\"sidebar-game-review-button\"]');\n    const popUpReviewButton = document.querySelector(\".ui_v5-button-component.ui_v5-button-primary.ui_v5-button-large.ui_v5-button-full.game-over-review-button-background\");\n    if (gameReviewButton) {\n        disableButton(gameReviewButton);\n        setTimeout(() => {\n            hijackButton(gameReviewButton);\n        }, 0);\n    }\n    if (popUpReviewButton) {\n        disableButton(popUpReviewButton);\n        setTimeout(() => {\n            hijackButton(popUpReviewButton);\n        }, 0);\n    }\n    if (gameReviewButton && popUpReviewButton) {\n        observer.disconnect();\n        ready = true;\n    }\n});\nconst lichess = (def = true) => {\n    const shareButton = def ? document.querySelector(\".icon-font-chess.share.live-game-buttons-button\") : document.querySelector('button[aria-label=\"Share\"]');\n    if (!shareButton) {\n        alert(\"Error: Unable to find PGN...\");\n        return;\n    }\n    setTimeout(() => {\n        shareButton.click();\n        const checkPGN = () => {\n            var _a;\n            const PGNElement = document.querySelector(\".share-menu-tab-pgn-textarea\");\n            if (PGNElement) {\n                const closeButton = document.querySelector(\"div.icon-font-chess.x.ui_outside-close-icon\");\n                const black = document.getElementsByClassName(\"board flipped\").length > 0;\n                closeButton === null || closeButton === void 0 ? void 0 : closeButton.click();\n                try {\n                    const formatted = parser(PGNElement.value);\n                    const link = `https://lichess.org/analysis/pgn/` +\n                        formatted +\n                        (black ? \"?color=black\" : \"\");\n                    (_a = window.open(link, \"_blank\")) === null || _a === void 0 ? void 0 : _a.focus();\n                }\n                catch (error) {\n                    isLichessInProgress = false;\n                    alert(\"Error: Something went wrong...\");\n                    throw new Error(\"Couldn't open new page\");\n                }\n            }\n            else {\n                setTimeout(checkPGN, 100);\n            }\n        };\n        checkPGN();\n    }, 100);\n    isLichessInProgress = false;\n};\ngameEndObserver.observe(document.body, { childList: true, subtree: true });\nchrome.runtime.onMessage.addListener((msg, sender, sendResponse) => {\n    if (msg.type === \"live\") {\n        if (ready) {\n            lichess();\n        }\n        sendResponse({ success: true });\n    }\n    else if (msg.type === \"events\") {\n        const button = document.querySelector('button[aria-label=\"Share\"]');\n        if (button) {\n            lichess(false);\n        }\n        else {\n            alert(\"Error: PGN not found. Try again in a moment if you believe this is an error\");\n        }\n    }\n    return true;\n});\n"],"names":[],"sourceRoot":""}